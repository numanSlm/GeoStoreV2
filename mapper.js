//json data
var getdata={ 
    "stores" :
        [       
            {
                "storeNumber": "Mum1",
                "id": "1",
                "name": "Inorbit Mall, Malad (W)",
                "zone": "Mumbai",
                "address": "F-58, First Floor Inorbit Mall, Link Road Malad (West), Mumbai - 400064 .",
                "tel": {
                    "tel1" : "022 - 28778735",
                    "tel2" : "022 - 28778735"
                },
                "timing": "10.00 am to 9.30 pm",
                "workingdays": "All days",
                "gmaps" : "https://www.google.com/maps/place/Envi+Salon+And+Spa+-+Malad/@19.173549,72.835643,16z/data=!4m5!3m4!1s0x0:0xbb59275dee1468f6!8m2!3d19.1735488!4d72.8356428?hl=en-US",                        
                "whatsapp" : "https://api.whatsapp.com/send?phone=919152005222&text=hi",
                "mail" : "info@envisalon.in",
                "readmore" : "https://envi1.hscprojects.com/inorbit-mall-malad-west/",
                "coordinates":  {
                    "latitude": 19.17417728738802,  
                    "longitude": 72.83570737301531
                                } 
            },
        
            {
                "storeNumber": "Mum2",
                "id": "2",
                "name": "Oberoi Mall, Goregaon (E)",
                "zone": "Mumbai",
                "address": "S-11, Oberoi Mall, 2nd Floor Off, Western Exp Highway, Goregaon (E), Mumbai-400063 .",
                "tel": {
                    "tel1" : "022 - 28428111",
                    "tel2" : "022 - 28415858"
                },
                "timing": "10.00 am to 9.30 pm",
                "workingdays": "All days",
                "gmaps" : "https://www.google.com/maps/place/Envi+Salon+%26+Spa+-+Goregaon+East/@19.173822,72.860811,19z/data=!4m5!3m4!1s0x0:0x73ea43453be8fed6!8m2!3d19.1738217!4d72.8608108?hl=en-US",                        
                "whatsapp" : "https://api.whatsapp.com/send?phone=919152005222&text=hi",
                "mail" : "info@envisalon.in",
                "readmore" : "https://envi1.hscprojects.com/oberoi-mall-goregoan-east/",
                "coordinates":  {
                    "latitude": 19.17389293567528,  
                    "longitude": 72.86082441104486
                                } 
            },


        {
        "storeNumber": "Mum3",
        "id": "3",
        "name": "Link Road, Andheri West",
        "zone": "Mumbai",
        "address": "Unit 2, Stanford Plaza, Besides Orritel West Hotel, Off, New Link Rd, Anand Nagar, Andheri West, Mumbai, Maharashtra - 400047 .",
        "tel": {
            "tel1" : "+91 77770 04034"
        },
        "timing": "10.00 am to 9.30 pm",
        "workingdays": "All days",
        "gmaps" : "https://www.google.com/maps/place/Envi+Salon+and+Spa+-+Andheri/@19.139763,72.834226,16z/data=!4m5!3m4!1s0x0:0x9dc312acfd587861!8m2!3d19.1397632!4d72.8342263?hl=en-US",                        
        "whatsapp" : "https://api.whatsapp.com/send?phone=919152005222&text=hi",
        "mail" : "info@envisalon.in",
        "readmore" : "https://envi1.hscprojects.com/link-road-andheri-west/",
        "coordinates":  {
            "latitude": 19.14018870149455,  
            "longitude": 72.83433328835888
                        } 
        },



        {
        "storeNumber": "Pune1",
        "id": "4",
        "name": "Westend Mall, Pune",
        "zone": "Pune",
        "address": "Unit no 13, Higher Ground Floor, Westend Mall, Aundh, Pune - 411007",
        "tel": {
            "tel1" : "020 - 27207481",
            "tel2" : "020 - 27207482"
        },
        "timing": "10.00 am to 9.30 pm",
        "workingdays": "All days",
        "gmaps" : "https://www.google.com/maps/place/Envi+Salon+%26+Spa+-+Aundh/@18.561485,73.80722,12z/data=!4m5!3m4!1s0x0:0x59eab11c8595953f!8m2!3d18.561485!4d73.80722?hl=en-US",                        
        "whatsapp" : "https://api.whatsapp.com/send?phone=919152005222&text=hi",
        "mail" : "info@envisalon.in",
        "readmore" : "https://envi1.hscprojects.com/westend-mall-pune/",
        "coordinates":  {
            "latitude": 18.57189952984978,  
            "longitude": 73.80447341801286
                        } 
        },
        
        {
        "storeNumber": "Pune2",
        "id": "5",
        "name": "Amanora Mall, Pune",
        "zone": "Pune",
        "address": "Store no. WB-GF 21, Ground floor, Hadapsar Kharadi, Bypass Hadapsar, Pune - 411028.",
        "tel": {
            "tel1" : "020 - 67267945",
            "tel2" : "020 - 67267946"
        },  
        "timing": "10.00 am to 9.30 pm",
        "workingdays": "All days",
        "gmaps" : "https://www.google.com/maps/place/Envi+Salon+%26+Spa+-+Amanora+Mall/@18.518648,73.934131,14z/data=!4m5!3m4!1s0x0:0xf59c52e9ea7be834!8m2!3d18.518648!4d73.934131?hl=en-US",                        
        "whatsapp" : "https://api.whatsapp.com/send?phone=919152005222&text=hi",
        "mail" : "info@envisalon.in",
        "readmore" : "https://envi1.hscprojects.com/amanora-mall-pune/",
        "coordinates":  {
            "latitude": 18.520194334655034,  
            "longitude": 73.93430266137419
                        } 
        },
    


        
        {
        "storeNumber": "hyderabad1",
        "id": "6",
        "name": "Inorbit Mall - Hyderabad",
        "zone": "Hyderabad",
        "address": "G 52, Ground Floor, Mind Space, Madhapur, Opp. Durgam Cheruve, (Cydrabad), Hyderabad - 500081.",
        "tel": {
            "tel1" : "040 - 40036014",
            "tel2" : "040 - 40036015"
        },  
        "timing": "10.00 am to 9.30 pm",
        "workingdays": "All days",
        "gmaps" : "https://www.google.com/maps/place/Envi+Salon+%26+Spa+-+Madhapur/@17.4347,78.386955,16z/data=!4m5!3m4!1s0x0:0x1346ed361af516a4!8m2!3d17.4347!4d78.386955?hl=en-US",                        
        "whatsapp" : "https://api.whatsapp.com/send?phone=919152005222&text=hi",
        "mail" : "info@envisalon.in",
        "readmore" : "https://envi1.hscprojects.com/inorbit-mall-hyderabad/",
        "coordinates":  {
            "latitude": 17.43521179642681,  
            "longitude": 78.38697645767178
                        } 
        },

        {
        "storeNumber": "hyderabad2",
        "id": "7",
        "name": "Banjara Hills - Hyderabad",
        "zone": "Hyderabad",
        "address": "H.No. 8-2-684/3/162, Road No 12, Banjara Hills, Hyderabad - 500034.",
        "tel": {
            "tel1" : "+91 9393601415",
            "tel2" : "040 - 9393601416"
        },  
        "timing": "10.00 am to 9.30 pm",
        "workingdays": "All days",
        "gmaps" : "https://www.google.com/maps/place/Envi+Salon+%26+Spa+-+Banjara+Hills/@17.412536,78.430904,14z/data=!4m5!3m4!1s0x0:0x2a2723a5c3fdb157!8m2!3d17.412536!4d78.430904?hl=en-US",                        
        "whatsapp" : "https://api.whatsapp.com/send?phone=919152005222&text=hi",
        "mail" : "info@envisalon.in",
        "readmore" : "https://envi1.hscprojects.com/banjara-hills-hyderabad/",
        "coordinates":  {
            "latitude": 17.414747218713707,  
            "longitude": 78.43081816931291
                        } 
        },
    ]
}

//end json data


// Menu button
$(document).ready(function() {
    $(".menu-icon").on("click", function() {
          $("nav ul").toggleClass("showing");
    });
});

// Scroll 

$(window).on("scroll", function() {
    if($(window).scrollTop()) {
          $('nav').addClass('black');
    }

    else {
          $('nav').removeClass('black');
    }
})



//hiding tab script
function openCity(e, x) {
      var allCities = ['Mumbai', 'Pune','Hyderabad','Kolkata'];
      for(var i in allCities){
            document.querySelector('#' + allCities[i]).style.display = 'none';
      }
      document.querySelector('#'+x).style.display = 'block';

}

//sidebar store locator expander

function openNav() {
    document.getElementById("mySidebar").style.width = "40vw"; 
  }
  
function closeNav() {
    document.getElementById("mySidebar").style.width = "0";
  }


//calc city dist for tabs on main page
function Distance(x1, y1, x2, y2) {
    return Math.sqrt(Math.pow(x1-x2, 2) + Math.pow(y1-y2, 2));
}

openCity(null, 'Mumbai');


//AutoGeolocation on window onload

if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
      //console.log(position);
      let lat= position.coords.latitude;
      let long=position.coords.longitude;
      let nearestStore = null;
      let minDistance = 1e10;
      for(var i=0; i<getdata.stores.length; ++i) {
          for(var j=0; j<getdata.stores[i].length; ++j){
              const distance = Distance(lat, long, getdata.stores[i][j].coordinates.latitude, getdata.stores[i][j].coordinates.longitude);
              if(distance < minDistance) {
                  minDistance = distance;
                  nearestStore = getdata.stores[i][j];
                 //displays  location , for debug use
                  //console.log(nearestStore.zone, minDistance)
              }
          }
      }
      if(!nearestStore) nearestStore = getdata.stores[0][0];
      //openCity(null, nearestStore.zone);
      });
};



// button locate on user button press event if not allowed earlier
function geolocation(){    
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position){
            let lat= position.coords.latitude;
            let long=position.coords.longitude;

            localStorage.setItem('lat', lat);
            localStorage.setItem('long', long);

            fillStoreList(lat, long);
        });
        
    }
  };


//store template render

function clearStoreSearch(storeList) {
    while(storeList.firstChild) storeList.removeChild(storeList.firstChild);
}

function degToRad(deg) {return deg*Math.PI/180;}

function euclideanDistance(lat1,lon1,lat2,lon2)  {
    // var distance = Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));
    // convert distance to KMs and return
    var dLat = degToRad(lat2-lat1); 
    var dLon = degToRad(lon2-lon1); 
    var a = 
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(degToRad(lat1)) * Math.cos(degToRad(lat2)) * 
        Math.sin(dLon/2) * Math.sin(dLon/2)
        ; 
    return 6371 * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
}

window.addEventListener('DOMContentLoaded',function(){
    var searchForm = document.querySelector('#search-me-form');
    searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        var searchQuery = document.querySelector('#gSearch');
       
    });
    
})

//search auto autocomplete
let autocomplete;
function initAutocomplete(){
    autocomplete=new google.maps.places.Autocomplete(
        document.getElementById("gSearch"),
    
    {
        componentRestrictions:{'country':['IN']} 
    });
    autocomplete.addListener('place_changed',onPlaceChanged);
}

function onPlaceChanged(){
    var place = autocomplete.getPlace();
    if(!place.geometry){
        document.getElementById('gsearch').placeholder='Enter a Place';
    } else {
        var lat = place.geometry.location.lat();
        var long = place.geometry.location.lng();
        fillStoreList(lat, long);
    }  
}

function getNearestStores(lat, long) {
    var stores = getdata.stores;
    
    for(var store in stores) {
        stores[store].distance =  euclideanDistance(lat, long, stores[store].coordinates.latitude, stores[store].coordinates.longitude); 
    }
    return stores.sort(function sorter(a, b){return a.distance > b.distance ? 1 : -1}).slice(0, 3);
}

// filling stores
function fillStoreList(lat, long) {
    var stores = getNearestStores(lat, long);

    var storeTemplate = document.querySelectorAll('.store-search-template')[0];
    var storeList = document.querySelector('#stores-list');
    clearStoreSearch(storeList);
    for(var store in stores) {
        var storeNode = storeTemplate.cloneNode(true)
        storeNode.style.display = 'block';
        storeNode.querySelectorAll('.store-name')[0].innerHTML = stores[store].name;
        storeNode.querySelectorAll('.store-address')[0].innerHTML = stores[store].address;
        storeNode.querySelectorAll('.store-distance')[0].innerHTML = "Just " + stores[store].distance.toFixed(2) + " KMs Away"; 
        storeNode.querySelectorAll('.store-map-link')[0].href =stores[store].gmaps
        storeNode.querySelectorAll('.store-whatsapp')[0].href = stores[store].whatsapp
        storeList.appendChild(storeNode);
    }
}

//



